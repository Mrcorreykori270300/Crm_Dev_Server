@{
    ViewBag.Title = "Create Ticket || Transaction";
    Layout = "~/Views/Shared/_LayoutTicket.cshtml";
}
<style type="text/css">
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #myMap {
        height: 350px;
        width: auto;
    }

    .cert {
        display: none;
    }

    #office_add {
        display: none;
    }

    #Contact_add {
        display: none;
    }

    #loadermodel {
        display: none;
    }
</style>
<nav class="pcoded-navbar menupos-fixed menu-light brand-blue">
    <div class="navbar-wrapper">
        <div class="navbar-content scroll-div">
            <ul class="nav pcoded-inner-navbar" style="margin-top: 45%;font-size: 16px;">
                <li class="nav-item active">
                    <a href="#" class="nav-link  text-center has-ripple"><span class="pcoded-mtext">INFO BAR</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Customer" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-user-circle"></i></span><span class="pcoded-mtext">Customer</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Ticket" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-info-circle"></i></span><span class="pcoded-mtext">Case Details</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Site" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-map-marker-alt"></i></span><span class="pcoded-mtext">Site</span></a>
                </li>
                <li class="nav-item disabled">
                    <a href="#FE" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-user"></i></span><span class="pcoded-mtext">FE Detail</span></a>
                </li>
                <li class="nav-item disabled">
                    <a href="#Activity" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-ticket-alt"></i></span><span class="pcoded-mtext">Activity</span></a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="pcoded-main-container">
    <div class="pcoded-wrapper container" style="margin-top: -15px;">
        <div class="pcoded-content-ticket">
            <div class="pcoded-inner-content">
                <div class="main-body">

                    @using (Html.BeginForm("CreateTicket", "Transaction", FormMethod.Post, new { enctype = "multipart/form-data", role = "form", @class = "col-12" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.ValidationSummary("", new { @class = "text-danger" })
                        <input type="hidden" name="pregame_detail" value="1. Please reach the site on time Important.
2. Please follow the formal dress Code.
3. Make sure you carry all desired tools onsite as requested.
4. Phone should be completely charged.
5. Engineer has to share the system picture with the serial number before commencing the work.
6. We need to verify the serial number of the device prior to starting any repairs and we need to get the customer's approval before starting any repairs.
7. Be polite, patient and do not use any profanity language while onsite.
8. If any issue's or any doubt, please call.
9. If the parts are damaged or any fault in the system made by the end customer, you should inform us immediately or before leaving the site.
10. If any issue related to payment, extra hours, pricing, or any other issues related to payments please do not communicate or discuss with the client, do not mention on WhatsApp group
11. Once activity is completed, make sure the site is left neat & clean always.  Support Team needs to confirm the repair with the customer prior to your release.
12. If any faulty part needs to be shipped, please write a mail to parts@inwinteck.com with all details such as Serial No and Return Label details with address of location from where parts to be picked up.
13. Following are the pregame points for supermicro:
• Make sure you carry all desired tools the torque limiting screwdriver with Bits T20, T25, T30, and thermal paste.
• Once the task is completed, please pack the faulty parts label them, and share the picture in the group. And do not carry the parts.">
                        <div class="container-fluid">

                            <div class="row">
                                <div class="col-md-12">
                                    <!-- Basic Forms -->
                                    <div class="card">

                                        <!-- /.box-header -->
                                        <div class="card-body" id="Customer" style="margin-top: -15px;">
                                            <span class="heading-border">Customer Details</span>

                                            <div class="form-row m-t-10">
                                                <label for="EU_ID" class="col-sm-2 col-form-label">Customer</label>
                                                <div class="col-sm-4">
                                                    <select class="form-control" name="EU_ID" id="EU_ID" required>
                                                        <option value="">Select Customer</option>
                                                        @foreach (var i in ViewBag.Customer)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                                <label for="EU_ID" class="col-sm-2 col-form-label">Office</label>
                                                <div class="col-sm-3">
                                                    <select class="form-control" name="EU_Office" id="Office" required>
                                                        <option value="">Select Office</option>
                                                      
                                                    </select>
                                                </div>
                                                <button type="button" class="btn btn-icon btn-info has-ripple" data-toggle="modal" data-target="#contact_info"><i class="fas fa-user"></i></button>
                                            </div>
                                            <div class="form-row">
                                                <label for="Email_Subject" class="col-sm-2 col-form-label">Email Subject</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="Email_Subject" id="Email_Subject" autocomplete="nope"  placeholder="Enter your Subject or Leave Blank" required>
                                                </div>

                                            </div>

                                            <div class="form-row">
                                                <label for="Email_Subject" class="col-sm-2 col-form-label">Customer Auto Mail</label>
                                                <div class="col-md-10">
                                                    <input type="text" class="form-control" name="email_office" value="" autocomplete="nope"  id="email_office" required>
                                                </div>

                                            </div>
                                            <div class="modal fade bs-example-modal-lg" id="contact_info" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
                                                <div class="modal-dialog modal-lg">
                                                    <div class="modal-content" style="width: 1080px;margin-left: -10%;">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" id="myLargeModalLabel">Detail</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                            <div class="spinner-border text-primary" role="status" id="loadermodel">
                                                                <span class="sr-only">Loading...</span>
                                                            </div>
                                                        </div>
                                                        <div class="modal-body">

                                                            <div class="row">

                                                                <div class="col-6">

                                                                    <input type="hidden" name="Contact_ID" id="Contact_ID" value="0" />

                                                                    <div class="form-row">
                                                                        <label for="Website" class="col-sm-4 col-form-label">Person</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Person" id="Person" placeholder="Enter Contact Person">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="Email" class="col-sm-4 col-form-label">Designation</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Designation" id="Designation" placeholder="Enter Contact Designation">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="Email" class="col-sm-4 col-form-label">Department</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Department" id="Department"  placeholder="Enter Contact Department">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="Number" class="col-sm-4 col-form-label">Number</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Number" id="CNumber" placeholder="Enter Office Number">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="City" class="col-sm-4 col-form-label">Email</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Email" id="CEmail" placeholder="Enter Office Email">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-row">
                                                                        <div class="form-group col-md-12 text-center">

                                                                            <input type="button" class="btn btn-primary" value="Add" id="Contact_btn" />
                                                                            <button type="button" title="Add" class="btn btn-link has-ripple" id="Contact_add"><i class="fa fa-plus"></i></button>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="col-sm-6 table-border-style">
                                                                    <div class="table-responsive">
                                                                        <table class="table" id="Office_contact">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Select</th>
                                                                                    <th>Person</th>
                                                                                    <th>Action</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody></tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="modal-footer text-center">
                                                                <button type="button" class="btn btn-info waves-effect " id="save_value" data-dismiss="modal">Ok</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <!-- /.box-body -->

                                        <div class="card-body" id="Ticket" style="margin-top: -42px;">
                                            <span class="heading-border">Case Details</span>

                                            <div class="form-row m-t-10">
                                                <label for="Ticket_Mode" class="col-sm-2 col-form-label">Case Mode</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" name="Ticket_Mode"  id="Ticket_Mode" required>
                                                        <option value="">Select Ticket Mode</option>
                                                        @foreach (var i in ViewBag.Ticket_Mode)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                                <label for="Ticket_Type" class="col-sm-2 col-form-label">Case Type</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" name="Ticket_Type" id="Ticket_Type" required>
                                                        <option value="">Select Ticket Type</option>
                                                        @foreach (var i in ViewBag.Ticket_Type)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-row">
                                                <label for="SLA" class="col-sm-2 col-form-label">SLA</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" name="SLA" id="SLA" required>
                                                        <option value="">Select SLA</option>
                                                        @foreach (var i in ViewBag.SLA)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                                <label for="Ticket_Date" class="col-sm-2 col-form-label">Case Date</label>
                                                <div class="col-md-4">
                                                    <input type="datetime-local" class="form-control dateHour" name="Ticket_Date" id="Ticket_Date" placeholder="Enter your ZipCode/Pincode" required>
                                                </div>
                                            </div>

                                            <div class="form-row">
                                                <label for="Ticket_Priority" class="col-sm-2 col-form-label">Case Priority</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" name="Ticket_Priority" id="Ticket_Priority" required>
                                                        <option value="">Select Priority</option>
                                                        @foreach (var i in ViewBag.Ticket_Priority)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                                <label for="Case_No" class="col-sm-2 col-form-label">Case No</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="Case_No" id="Case_No"  autocomplete="nope" placeholder="Enter your Case No" required>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <label class="col-sm-2 col-form-label">Scope of Work</label>
                                                <div class="col-md-10">
                                                    <textarea class="form-control" rows="3" placeholder="Add Scope of Work" autocomplete="nope" name="Job_Description" required></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row ">
                                                <table class="table" id="maintable">
                                                    <thead>
                                                        <tr>
                                                            <th>System Information</th>
                                                            <th>Make/Model</th>
                                                            <th>Serial Number</th>
                                                            <th>Required Tool</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="data-contact-person">
                                                            <td>
                                                                <select class="form-control f-name01" name="IV[0].System_Information" required>
                                                                    <option value="">Select System</option>
                                                                    @foreach (var i in ViewBag.System_Info)
                                                                    {
                                                                        <option value="@i.Text">@i.Text</option>
                                                                    }
                                                                </select>
                                                            </td>
                                                            <td>
                                                                <input type="text" name="IV[0].Make_Model" class="form-control l-name01" />
                                                            </td>
                                                            <td>
                                                                <input type="text" name="IV[0].Serial_Number" class="form-control email01" />
                                                            </td>
                                                            <td>
                                                                <input type="text" name="IV[0].Required_Tool" class="form-control email02" />
                                                            </td>
                                                            <td>
                                                                <button type="button" id="btnAdd" class="btn btn-xs btn-primary classAdd"><i class="fas fa-plus-circle"></i></button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>


                                        <div class="card-body" id="Site" style="margin-top: -40px;">
                                            <span class="heading-border">Site Details</span>

                                            <div class="form-row m-t-10">
                                                <label for="OEM" class="col-sm-2 col-form-label">OEM</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" name="OEM" id="OEM" required>
                                                        <option value="">Select OEM</option>
                                                        @foreach (var i in ViewBag.OEM)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                                <label for="Site_Name" class="col-sm-2 col-form-label">Site Name</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="Site_Name" autocomplete="nope" id="Site_Name" placeholder="Enter your Site Name" required>
                                                </div>
                                            </div>

                                            <div class="form-row">

                                                <label for="Street_Address" class="col-sm-2 col-form-label">Street Address</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="Street_Address" autocomplete="nope" placeholder="Enter your Street Address" id="Street_Address" required>
                                                </div>
                                                <label for="Zip_Pin_Code" class="col-sm-2 col-form-label">ZipCode/Pincode</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="Zip_Pin_Code" autocomplete="nope" id="ZipCode_Pincode" placeholder="Enter your ZipCode/Pincode" required>
                                                </div>
                                            </div>

                                            <div class="form-row">

                                                <label for="City" class="col-sm-2 col-form-label">City</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="City" autocomplete="nope" id="City" placeholder="Enter your City">
                                                </div>
                                                <label for="State" class="col-sm-2 col-form-label">State</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" name="State" autocomplete="nope" id="State" placeholder="Enter your State" required>
                                                </div>
                                            </div>

                                            <div class="form-row">

                                                <label for="Country" class="col-sm-2 col-form-label">Country</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" name="Country" id="Country" required>
                                                        <option value="">Select Country</option>
                                                        @foreach (var i in ViewBag.Country)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                                <label for="Dispatch_Date" class="col-sm-2 col-form-label">Dispatch Date & Time</label>
                                                <div class="col-md-4">
                                                    <input type="datetime-local" class="form-control dateHour" name="Dispatch_Date" id="Dispatch_Date" placeholder="Enter your ZipCode/Pincode" required>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <label for="TSE_Name" class="col-sm-2 col-form-label">TSE Name</label>
                                                <div class="col-md-4">
                                                    
                                                    <input type="text" class="form-control" name="TSE_Name" autocomplete="nope" id="TSE_Name" placeholder="Enter TSE Name">
                                                </div>
                                            </div>

                                                <div class="form-row ">
                                                    <table class="table" id="maintableeu">
                                                        <thead>
                                                            <tr>
                                                                <th>EU Name</th>
                                                                <th>EU Contact</th>
                                                                <th>EU Email</th>
                                                                <th>Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr class="data-eu-person">
                                                                <td>
                                                                    <input type="text" name="EUL[0].EU_Name" class="form-control l-name01" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" name="EUL[0].EU_Contact" class="form-control email01" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" name="EUL[0].EU_Email" class="form-control email02" />
                                                                </td>
                                                                <td>
                                                                    <button type="button" id="btnAddeu" class="btn btn-xs btn-primary classAddeu"><i class="fas fa-plus-circle"></i></button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>

                                                @*<div class="form-row">
                <label for="EU_Name" class="col-sm-2 col-form-label">EU Name</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" name="EU_Name" id="EU_Name" placeholder="Enter your Site Person Name">
                </div>
                <label for="EU_Contact" class="col-sm-2 col-form-label">EU Contact</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" name="EU_Contact" id="EU_Contact" placeholder="Enter your Site Person Contact">
                </div>
            </div>
            <div class="form-row">
                <label for="EU_Email" class="col-sm-2 col-form-label">EU Email</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" name="EU_Email" id="EU_Email" placeholder="Enter your Site Person Email">
                </div>
            </div>*@

                                                <div class="form-row">
                                                    <div id="myMap" class="col-md-12"></div>
                                                    <input type="hidden" class="form-control" id="latitude" name="latitude" placeholder="Latitude" />
                                                    <input type="hidden" class="form-control" id="longitude" name="longitude" placeholder="Longitude" />
                                                </div>

                                                <div class="form-row">

                                                    <label for="Certification_Need" class="col-sm-2 col-form-label">Certification Need</label>
                                                    <div class="col-md-4">
                                                        <select class="form-control" name="Certification_Need" id="Certification_Need" required>
                                                            <option value="">Select Certification</option>
                                                            <option value="1">Yes</option>
                                                            <option value="0">No</option>

                                                        </select>
                                                    </div>
                                                    <label for="Certification_Name" class="col-sm-2 col-form-label cert">Certification Name</label>
                                                    <div class="col-md-4 cert">
                                                        <select class="js-example-basic-multiple" name="Certification_Name" multiple="multiple" id="Certification">
                                                            @foreach (var i in ViewBag.Certification)
                                                            {
                                                                <option value="@i.Value">@i.Text</option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>


                                                <div class="form-row">
                                                    <label class="col-sm-2 col-form-label">Comments </label>
                                                    <div class="col-md-10">
                                                        <textarea class="form-control" rows="3" autocomplete="nope" placeholder="Add your request message here" name="Comments" required></textarea>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-12 text-center">
                                                        <input type="submit" class="btn btn-primary" value="Create" />
                                                        <a href="@Url.Action("Ticket","Transaction")" class="btn btn-info">Cancel</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <!-- /.box -->
                                    <!-- /.box -->

                                </div>
                            </div>

                        </div>
                    }
                </div>

            </div>
        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-lg" id="modal_FieldEngineer" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg" style="max-width:100%;">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Field Engineer</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body table-responsive">

                <table class="table" id="FieldEngineer_Tic" style="max-height: 500px;max-width:100%;overflow: scroll;">
                    <tbody>
                        <tr class="thead-dark">
                            <th>Name</th>
                            <th>City</th>
                            <th>State</th>
                            <th>Country</th>
                            <th>Business Hours Rate</th>
                            <th>Action</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-info waves-effect " data-dismiss="modal">ok</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade bs-example-modal-lg" id="modal_Pincode" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Pincode/Zipcode</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body table-responsive">
                <label for="EU_Email" class="col-sm-2 col-form-label">EU Email</label>
                <table class="table" id="FieldEngineer_PinZip" style="max-height: 500px;max-width:500px;overflow: scroll;">
                    <tbody>
                        <tr class="thead-dark">
                            <th>Pincode/Zipcode</th>
                            <th>City</th>
                            <th>State</th>
                            <th>Country</th>
                            <th>Action</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-info waves-effect " data-dismiss="modal">ok</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content  text-center">
            <div class="modal-header">
                <h4 class="modal-title text-center "><i class="fa fa-info-circle" aria-hidden="true"></i> Information</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p style="font-size: 20px;">@TempData["message"] </p>

            </div>
            <div class="modal-footer">
                <!-- <button type="button" class="btn btn-primary">Save changes</button> -->

                <a href="#" data-dismiss="modal" aria-label="Close" class="btn btn-primary">OK</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

@section scripts
{
    @if (TempData["message"] != null)
    {
        <script type="text/javascript">

            window.onload = function () {
                $('#myModal').modal('show');
            };
        </script>
    }

    <script type="text/javascript">
        window.onload = function () {
            geocode();
            initialize();
        };
        function clicked(item) {
            var id = $(item).attr("id");

            $("#FE").val($('#nam-' + id).val());
            $("#FE_ID").val($('#FEI-' + id).val());

        }

        function clickedon(item) {
            var id = $(item).attr("id");

            $("#City").val($('#city-' + id).val());
            $("#State").val($('#state-' + id).val());
            $("#Country").val($('#Country-' + id).val());

            var country = $('#Country-' + id).val();
            var code = $('#pin-' + id).val();


        }

        //$(function () {
        //    $('input[name="datetimes"]').daterangepicker({
        //        timePicker: true,
        //        startDate: moment().startOf('hour'),
        //        endDate: moment().startOf('hour').add(32, 'hour'),
        //        locale: {
        //            format: 'M/DD hh:mm A'
        //        }
        //    });
        //});


        $("#EU_ID").change(function () {
            var code = $(this).val();

            $.get(baseurl + "/Transaction/GetOffice", { Cnt: code }, function (data) {

                if (data.res == "Success") {
                    $('#Office').empty();
                    $('#Office').append('<option value ="">--Select Office--</option>');

                    $.each(data.CC, function (i, val) {

                        $('#Office').append('<option value =' + data.CC[i]['Id'] + '>' + data.CC[i]['Office'] + '</option>');
                    });

                } else {
                    $('#Office').append('<option value ="">--Select Office--</option>');
                }   
            });


        });


        $("#Office").change(function () {
            var code = $(this).val();



            $.get(baseurl + "/Transaction/GetContact", { Cnt: code }, function (data) {

                if (data.res == "Success") {
                    $('#Office_contact tr').has('td').remove();

                    $.each(data.CC, function (i, val) {

                        $('#Office_contact tr:last').after('<tr><td> <input type="checkbox" name="customCheck_' + data.CC[i]['Id'] + '" class="form-control" id="customCheck_' + data.CC[i]['Id'] + '"  value="' + data.CC[i]['Email'] + '" style="width: 20px; height: 20px;"></td><td><span class="badge" style="font-size:100%;" title = ' +
                            data.CC[i]['Email'] + " " + data.CC[i]['Number'] + '>'
                            + data.CC[i]['Person'] + " , " + data.CC[i]['Designation'] + '</span></td><td> <button type="button" title="edit" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactfill(this.id)"><i class="fa fa-edit"></i></button><button type="button" title="delete" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactdelete(this.id)"><i class="fa fa-trash"></i></button></td><tr>');
                    });

                } else {
                    $('#Office').append('<option value ="">--Select Office--</option>');
                }
            });


        });


        function Contactfill(id) {

            $.get(baseurl + "/Master/GetContact", { Id: id }, function (data) {

                if (data.res == "Success") {
                    $("#Contact_ID").val(data.CC['Id']);
                    $("#Person").val(data.CC['Person']);
                    $("#Designation").val(data.CC['Designation']);
                    $("#Department").val(data.CC['Department']);
                    $("#CNumber").val(data.CC['Number']);
                    $("#CEmail").val(data.CC['Email']);
                    $("#Contact_btn").val('Update');
                    $("#Contact_add").css('display', 'unset');
                }
                else {

                }
            });
        }

        function Contactdelete(id) {
          
            var code = $("#Office").val();
            $("#loadermodel").css('display', 'unset');
            $.get(baseurl + "/Transaction/deleteContact", { OC: id }, function (data) { });


            $.get(baseurl + "/Transaction/GetContact", { Cnt: code }, function (data) {

                if (data.res == "Success") {
                    $('#Office_contact tr').has('td').empty();

                    $.each(data.CC, function (i, val) {

                        $('#Office_contact tr:last').after('<tr><td> <input type="checkbox" name="customCheck_' + data.CC[i]['Id'] + '" class="form-control" id="customCheck_' + data.CC[i]['Id'] + '"  value="' + data.CC[i]['Email'] + '" style="width: 20px; height: 20px;"></td><td><span class="badge" style="font-size:100%;">'
                            + data.CC[i]['Person'] + " , " + data.CC[i]['Designation'] + '</span></td><td> <button type="button" title="edit" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactfill(this.id)"><i class="fa fa-edit"></i></button> <button type="button" title="delete" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactdelete(this.id)" style="margin-left:10%;"><i class="fa fa-trash"></i></button></td><tr>');
                    });

                    $("#Contact_ID").val(0);
                    $("#Person").val('');
                    $("#Designation").val('');
                    $("#Department").val('');
                    $("#CNumber").val('');
                    $("#CEmail").val('');

                } else {

                }
            });



            $("#loadermodel").css('display', 'none');
        }


        $("#Contact_btn").click(function () {
            $("#loadermodel").css('display', 'unset');
            var code = $("#Office").val();
           
            $.get(baseurl + "/Transaction/ContactEUMaster", {
                Office_ID: $("#Office").val(), Person: $("#Person").val(),
                Designation: $("#Designation").val(), Department: $("#Department").val(), Number: $("#CNumber").val(), Email: $("#CEmail").val(),
                Contact_ID: $("#Contact_ID").val()
            }, function (data) { });

            $.get(baseurl + "/Transaction/GetContact", { Cnt: code }, function (data) {

                if (data.res == "Success") {
                    $('#Office_contact tr').has('td').empty();

                    $.each(data.CC, function (i, val) {

                        $('#Office_contact tr:last').after('<tr><td> <input type="checkbox" name="customCheck_' + data.CC[i]['Id'] + '" class="form-control" id="customCheck_' + data.CC[i]['Id'] + '"  value="' + data.CC[i]['Email'] + '" style="width: 20px; height: 20px;"></td><td><span class="badge" style="font-size:100%;">'
                            + data.CC[i]['Person'] + " , " + data.CC[i]['Designation'] + '</span></td><td> <button type="button" title="edit" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactfill(this.id)"><i class="fa fa-edit"></i></button> <button type="button" title="delete" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactdelete(this.id)" style="margin-left:10%;"><i class="fa fa-trash"></i></button></td><tr>');
                    });
                    $("#Contact_ID").val(0);
                    $("#Person").val('');
                    $("#Designation").val('');
                    $("#Department").val('');
                    $("#CNumber").val('');
                    $("#CEmail").val('');

                } else {

                }
            });
            $("#loadermodel").css('display', 'none');
        });


        $("#Contact_add").click(function () {
            $("#Contact_ID").val(0);
            $("#Person").val('');
            $("#Designation").val('');
            $("#Department").val('');
            $("#CNumber").val('');
            $("#CEmail").val('');
            $("#Contact_btn").val('Add');
            $("#Contact_add").css('display', 'none');
        });

        $('#save_value').click(function () {

            var val = [];
            $(':checkbox:checked').each(function (i) {
                val[i] = $(this).val();
            });
            $('#email_office').val(val);

        });

        $("#Street_Address").blur(function () {
            geocode()
        });

        function initialize() {

            var map;
            var marker;
            var lat;
            var log;

            lat = $('#latitude').val();
            log = $('#longitude').val();


            var myLatlng = new google.maps.LatLng(lat, log);
            var geocoder = new google.maps.Geocoder();
            var infowindow = new google.maps.InfoWindow();
            var mapOptions = {
                zoom: 18,
                center: myLatlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            map = new google.maps.Map(document.getElementById("myMap"), mapOptions);

            marker = new google.maps.Marker({
                map: map,
                position: myLatlng,
                draggable: true
            });

            geocoder.geocode({ 'latLng': myLatlng }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        $('#latitude,#longitude').show();
                        //  $('#Street_Address').val(results[0].formatted_address);
                        $('#latitude').val(marker.getPosition().lat());
                        $('#longitude').val(marker.getPosition().lng());
                        infowindow.setContent(results[0].formatted_address);
                        infowindow.open(map, marker);
                    }
                }
            });

            google.maps.event.addListener(marker, 'dragend', function () {

                geocoder.geocode({ 'latLng': marker.getPosition() }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            //   $('#Street_Address').val(results[0].formatted_address);
                            $('#latitude').val(marker.getPosition().lat());
                            $('#longitude').val(marker.getPosition().lng());
                            var address = results[0].address_components;
                            $('#ZipCode_Pincode').val(address[address.length - 1].long_name);
                            $('#City').val(address[address.length - 4].long_name);
                            $('#State').val(address[address.length - 3].long_name);
                            $('#Country').val(address[address.length - 2].long_name);
                            infowindow.setContent(results[0].formatted_address);
                            infowindow.open(map, marker);
                        }
                    }
                });
            });

        }


        function geocode() {

            var location = $('#Street_Address').val();

            axios.get('https://maps.googleapis.com/maps/api/geocode/json', {
                params: {
                    address: location,
                    key: 'AIzaSyBvhQbrULBXqk9wPb9RjTeacVk3A3g-ci8'
                }
            })
            .then(function (response) {
                // Log full response
                console.log(response);

                // Formatted Address
                var formattedAddress = response.data.results[0].formatted_address;


                // Address Components
                var addressComponents = response.data.results[0].address_components;


                // Geometry
                var lat = response.data.results[0].geometry.location.lat;
                var lng = response.data.results[0].geometry.location.lng;


                // Output to app
                $('#latitude').val(lat);
                $('#longitude').val(lng);

                //map
                var myLatlng = new google.maps.LatLng(lat, lng);
                var geocoder = new google.maps.Geocoder();
                var infowindow = new google.maps.InfoWindow();
                var mapOptions = {
                    zoom: 18,
                    center: myLatlng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };

                map = new google.maps.Map(document.getElementById("myMap"), mapOptions);

                marker = new google.maps.Marker({
                    map: map,
                    position: myLatlng,
                    draggable: true
                });

                geocoder.geocode({ 'latLng': myLatlng }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            $('#latitude,#longitude').show();
                            //   $('#Street_Address').val(results[0].formatted_address);
                            $('#latitude').val(marker.getPosition().lat());
                            $('#longitude').val(marker.getPosition().lng());
                            var address = results[0].address_components;
                            $('#ZipCode_Pincode').val(address[address.length - 1].long_name);
                            $('#City').val(address[address.length - 4].long_name);
                            $('#State').val(address[address.length - 3].long_name);
                            $('#Country').val(address[address.length - 2].long_name);
                            infowindow.setContent(results[0].formatted_address);
                            infowindow.open(map, marker);
                        }
                    }
                });

                google.maps.event.addListener(marker, 'dragend', function () {

                    geocoder.geocode({ 'latLng': marker.getPosition() }, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            if (results[0]) {
                                //   $('#Street_Address').val(results[0].formatted_address);
                                $('#latitude').val(marker.getPosition().lat());
                                $('#longitude').val(marker.getPosition().lng());
                                var address = results[0].address_components;
                                $('#ZipCode_Pincode').val(address[address.length - 1].long_name);
                                $('#City').val(address[address.length - 4].long_name);
                                $('#State').val(address[address.length - 3].long_name);
                                $('#Country').val(address[address.length - 2].long_name);
                                infowindow.setContent(results[0].formatted_address);
                                infowindow.open(map, marker);
                            }
                        }
                    });
                });


            })
            .catch(function (error) {
                console.log(error);
            });
        }

        $("#Certification_Need").change(function () {

            if ($("#Certification_Need option:selected").val() == 1) {

                $(".cert").css('display', 'grid');
            }
            else {
                $(".cert").css('display', 'none');
            }
        });

        $(document).on("click", ".classAdd", function () { //
            var rowCount = $('.data-contact-person').length + 1;
            var i = rowCount - 1;
            var contactdiv = '<tr class="data-contact-person">' +
                '<td> <select class="form-control f-name01" name="IV['+i+'].System_Information" required><option value="">Select System</option>@foreach (var i in ViewBag.System_Info){<option value="@i.Text">@i.Text</option>}</select></td> ' +
                '<td><input type="text" name="IV[' + i + '].Make_Model" class="form-control l-name01" /></td>' +
                '<td><input type="text" name="IV[' + i + '].Serial_Number" class="form-control email01" /></td>' +
                '<td><input type="text" name="IV[' + i + '].Required_Tool" class="form-control email02" /></td>' +
                '<td><button type="button" id="btnAdd" class="btn btn-xs btn-primary classAdd"><i class="fas fa-plus-circle"></i></button>' +
                '<button type="button" id="btnDelete" class="deleteContact btn btn btn-danger btn-xs"><i class="fas fa-minus-circle"></i></button></td>' +
                '</tr>';
            $('#maintable').append(contactdiv); // Adding these controls to Main table class
        });

        $(document).on("click", ".deleteContact", function () {
            $(this).closest("tr").remove(); // closest used to remove the respective 'tr' in which I have my controls
        });

            $(document).on("click", ".classAddeu", function () { //
            var rowCount = $('.data-eu-person').length + 1;
            var i = rowCount - 1;
                var contactdiv = '<tr class="data-eu-person">' +
                    '<td> <input type="text" class="form-control f-name01" name="EUL[' + i +'].EU_Name" /></td> ' +
                    '<td><input type="text" name="EUL[' + i + '].EU_Contact" class="form-control l-name01" /></td>' +
                    '<td><input type="text" name="EUL[' + i + '].EU_Contact" class="form-control email01" /></td>' +
                '<td><button type="button" id="btnAddeu" class="btn btn-xs btn-primary classAddeu"><i class="fas fa-plus-circle"></i></button>' +
                '<button type="button" id="btnDeleteeu" class="deleteContacteu btn btn btn-danger btn-xs"><i class="fas fa-minus-circle"></i></button></td>' +
                '</tr>';
            $('#maintableeu').append(contactdiv); // Adding these controls to Main table class
        });

        $(document).on("click", ".deleteContacteu", function () {
            $(this).closest("tr").remove(); // closest used to remove the respective 'tr' in which I have my controls
        });
    </script>
}


